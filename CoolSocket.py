import socket

# Надстройка над сокетом
# Умеет получать текст до определённого символа
# Можно задать стандартный символ до которого будет смотреть
# Возвращает подчищенную строку: удаляет последнюю линию, приводит к типу string

# Умеет отправлять текст
# Переход на новую строку и преобразование в байты уже учтены

class CoolSocket:

    name = "[Cool socket]  "
    timeout = 1
    default_symbol = '>'

    def __init__(self, ip, port):
        print(self.name + "Cool socket makes brrrrr")
        self.sock = socket.socket()
        self.sock.connect((ip, port))

        self.sock.settimeout(self.timeout)

    def SetDefaultSymbol(self, sym):
        self.default_symbol = sym

    def GetContent(self, symbol=default_symbol):
        print(self.name + "Get content")
        data = ""
        newData = ""

        while(symbol not in newData):
            try:
                newData = self.sock.recv(1024).decode()
            except Exception:
                print(self.name + "Getting content too slow(. Increase timeout")
                newData = ""
                self.timeout += 1
                self.sock.timeout(self.timeout)
            data += newData

    
        data = data.split('\n')
        data.pop()

        return "".join(data)

    def SendContent(self, content):
        print(self.name + "Send \"" + content + "\"")
        content_bin = (content+"\n").encode()
        self.sock.send(content_bin)

    def SendGetContent(self, content, symbol=default_symbol):
        self.SendContent(content)
        return self.GetContent(symbol)
